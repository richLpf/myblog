<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Gin搭建项目-自动化构建 | pengfei&#39;s blog</title>
    <meta name="generator" content="VuePress 1.5.0">
    <link rel="icon" href="/myblog/img/favicon.ico">
    <meta name="description" content="web前端技术博客,简洁至上,专注web前端学习与总结。JavaScript,js,ES6,TypeScript,vue,golang,css3,html5,Node,git,github等技术文章。">
    <meta name="keywords" content="前端博客,个人技术博客,前端,前端开发,前端框架,web前端,前端面试题,技术文档,学习,面试,JavaScript,js,ES6,TypeScript,vue,python,css3,html5,Node,git,github,markdown">
    <meta name="baidu-site-verification" content="7F55weZDDc">
    <meta name="theme-color" content="#11a8cd">
    <link rel="preload" href="/myblog/assets/css/0.styles.0de14e93.css" as="style"><link rel="preload" href="/myblog/assets/js/app.56c8d9b2.js" as="script"><link rel="preload" href="/myblog/assets/js/2.d64386e3.js" as="script"><link rel="preload" href="/myblog/assets/js/21.138908cd.js" as="script"><link rel="prefetch" href="/myblog/assets/js/10.2bb810f5.js"><link rel="prefetch" href="/myblog/assets/js/11.afffc507.js"><link rel="prefetch" href="/myblog/assets/js/12.748e040e.js"><link rel="prefetch" href="/myblog/assets/js/13.38bdf855.js"><link rel="prefetch" href="/myblog/assets/js/14.a5cb210e.js"><link rel="prefetch" href="/myblog/assets/js/15.205712a7.js"><link rel="prefetch" href="/myblog/assets/js/16.7c73c22b.js"><link rel="prefetch" href="/myblog/assets/js/17.f9ddc802.js"><link rel="prefetch" href="/myblog/assets/js/18.b9b65524.js"><link rel="prefetch" href="/myblog/assets/js/19.53adc3fe.js"><link rel="prefetch" href="/myblog/assets/js/20.444f8846.js"><link rel="prefetch" href="/myblog/assets/js/22.fd01b098.js"><link rel="prefetch" href="/myblog/assets/js/23.9020e243.js"><link rel="prefetch" href="/myblog/assets/js/24.fd1e8c65.js"><link rel="prefetch" href="/myblog/assets/js/25.3c4608b5.js"><link rel="prefetch" href="/myblog/assets/js/26.56371733.js"><link rel="prefetch" href="/myblog/assets/js/27.8bccad78.js"><link rel="prefetch" href="/myblog/assets/js/28.16bcd2c0.js"><link rel="prefetch" href="/myblog/assets/js/29.1885be6b.js"><link rel="prefetch" href="/myblog/assets/js/3.4591b1ae.js"><link rel="prefetch" href="/myblog/assets/js/30.33213b60.js"><link rel="prefetch" href="/myblog/assets/js/31.7c850172.js"><link rel="prefetch" href="/myblog/assets/js/32.4b5f7a21.js"><link rel="prefetch" href="/myblog/assets/js/33.ccaecf22.js"><link rel="prefetch" href="/myblog/assets/js/34.0a26999b.js"><link rel="prefetch" href="/myblog/assets/js/35.9b590aa1.js"><link rel="prefetch" href="/myblog/assets/js/36.1ca58a7a.js"><link rel="prefetch" href="/myblog/assets/js/37.7d9549b5.js"><link rel="prefetch" href="/myblog/assets/js/38.56104b4e.js"><link rel="prefetch" href="/myblog/assets/js/39.972e2312.js"><link rel="prefetch" href="/myblog/assets/js/4.a0889f8f.js"><link rel="prefetch" href="/myblog/assets/js/40.8020eb62.js"><link rel="prefetch" href="/myblog/assets/js/41.2a7ff141.js"><link rel="prefetch" href="/myblog/assets/js/42.9ad177bf.js"><link rel="prefetch" href="/myblog/assets/js/43.1a560a35.js"><link rel="prefetch" href="/myblog/assets/js/44.6c6f55fd.js"><link rel="prefetch" href="/myblog/assets/js/45.8e1bf47d.js"><link rel="prefetch" href="/myblog/assets/js/46.22b3bb7e.js"><link rel="prefetch" href="/myblog/assets/js/47.9f164d16.js"><link rel="prefetch" href="/myblog/assets/js/48.2a3da599.js"><link rel="prefetch" href="/myblog/assets/js/49.6685bd35.js"><link rel="prefetch" href="/myblog/assets/js/5.c838d8e9.js"><link rel="prefetch" href="/myblog/assets/js/50.68c7fa33.js"><link rel="prefetch" href="/myblog/assets/js/51.c08057b5.js"><link rel="prefetch" href="/myblog/assets/js/52.fed75573.js"><link rel="prefetch" href="/myblog/assets/js/53.97321e4e.js"><link rel="prefetch" href="/myblog/assets/js/54.deafec0f.js"><link rel="prefetch" href="/myblog/assets/js/55.b1b84015.js"><link rel="prefetch" href="/myblog/assets/js/56.a07b72cc.js"><link rel="prefetch" href="/myblog/assets/js/57.79e4b9ac.js"><link rel="prefetch" href="/myblog/assets/js/58.fd5c72a1.js"><link rel="prefetch" href="/myblog/assets/js/59.c255c1f7.js"><link rel="prefetch" href="/myblog/assets/js/6.e6670809.js"><link rel="prefetch" href="/myblog/assets/js/60.71ee860e.js"><link rel="prefetch" href="/myblog/assets/js/61.803d62f9.js"><link rel="prefetch" href="/myblog/assets/js/62.afcda1cd.js"><link rel="prefetch" href="/myblog/assets/js/63.4dd0ac73.js"><link rel="prefetch" href="/myblog/assets/js/64.43d9e659.js"><link rel="prefetch" href="/myblog/assets/js/65.ce848847.js"><link rel="prefetch" href="/myblog/assets/js/66.a13edf3b.js"><link rel="prefetch" href="/myblog/assets/js/67.9bf2308e.js"><link rel="prefetch" href="/myblog/assets/js/68.74e42837.js"><link rel="prefetch" href="/myblog/assets/js/69.8adc0b66.js"><link rel="prefetch" href="/myblog/assets/js/7.b832467e.js"><link rel="prefetch" href="/myblog/assets/js/70.a0f35090.js"><link rel="prefetch" href="/myblog/assets/js/71.5a5e6ffa.js"><link rel="prefetch" href="/myblog/assets/js/72.5603e44c.js"><link rel="prefetch" href="/myblog/assets/js/73.4b70df7d.js"><link rel="prefetch" href="/myblog/assets/js/74.570926ad.js"><link rel="prefetch" href="/myblog/assets/js/75.ba00dade.js"><link rel="prefetch" href="/myblog/assets/js/76.f61788bc.js"><link rel="prefetch" href="/myblog/assets/js/77.a8842869.js"><link rel="prefetch" href="/myblog/assets/js/78.60a2287d.js"><link rel="prefetch" href="/myblog/assets/js/79.1463a07a.js"><link rel="prefetch" href="/myblog/assets/js/8.9c2244a9.js"><link rel="prefetch" href="/myblog/assets/js/80.1f17d433.js"><link rel="prefetch" href="/myblog/assets/js/81.03c61142.js"><link rel="prefetch" href="/myblog/assets/js/82.b49f86f1.js"><link rel="prefetch" href="/myblog/assets/js/83.d23fa78b.js"><link rel="prefetch" href="/myblog/assets/js/84.e674da1c.js"><link rel="prefetch" href="/myblog/assets/js/85.f93fd2c2.js"><link rel="prefetch" href="/myblog/assets/js/86.7173d4c7.js"><link rel="prefetch" href="/myblog/assets/js/87.09fd338e.js"><link rel="prefetch" href="/myblog/assets/js/88.acd07830.js"><link rel="prefetch" href="/myblog/assets/js/89.278e4670.js"><link rel="prefetch" href="/myblog/assets/js/9.2ae38228.js"><link rel="prefetch" href="/myblog/assets/js/90.b9955b2b.js"><link rel="prefetch" href="/myblog/assets/js/91.db2d0173.js"><link rel="prefetch" href="/myblog/assets/js/92.ccbb1d68.js"><link rel="prefetch" href="/myblog/assets/js/93.e84ca08b.js"><link rel="prefetch" href="/myblog/assets/js/94.6d0d8200.js">
    <link rel="stylesheet" href="/myblog/assets/css/0.styles.0de14e93.css">
  </head>
  <body class="theme-mode-light">
    <div id="app" data-server-rendered="true"><div class="theme-container sidebar-open"><header class="navbar blur"><div title="目录" class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/myblog/" class="home-link router-link-active"><img src="/myblog/img/EB-logo.png" alt="pengfei's blog" class="logo"> <span class="site-name can-hide">pengfei's blog</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/myblog/" class="nav-link">首页</a></div><div class="nav-item"><a href="/myblog/web/" class="nav-link">前端</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Golang" class="dropdown-title"><a href="/myblog/technology/" class="link-title">Golang</a> <span class="title" style="display:none;">Golang</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/myblog/pages/9a7ee40fc232253e/" class="nav-link">技术文档</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="随笔" class="dropdown-title"><a href="/myblog/more/" class="link-title">随笔</a> <span class="title" style="display:none;">随笔</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/myblog/pages/9a7ee40fc232253e/" class="nav-link">学习</a></li></ul></div></div><div class="nav-item"><a href="/myblog/about/" class="nav-link">关于</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="收藏" class="dropdown-title"><a href="/myblog/pages/beb6c0bd8a66cea6/" class="link-title">收藏</a> <span class="title" style="display:none;">收藏</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/myblog/pages/beb6c0bd8a66cea6/" class="nav-link">网站</a></li><li class="dropdown-item"><!----> <a href="/myblog/pages/eee83a9211a70f9d/" class="nav-link">资源</a></li><li class="dropdown-item"><!----> <a href="/myblog/pages/12df8ace52d493f6/" class="nav-link">Vue资源</a></li></ul></div></div> <a href="https://github.com/richLpf" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar" style="display:none;"><div class="blogger"><img src="https://cdn.jsdelivr.net/gh/xugaoyi/image_store/blog/20200103123203.jpg"> <div class="blogger-info"><h3>Pengfei</h3> <span>
        中后台全栈
      </span></div></div> <nav class="nav-links"><div class="nav-item"><a href="/myblog/" class="nav-link">首页</a></div><div class="nav-item"><a href="/myblog/web/" class="nav-link">前端</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Golang" class="dropdown-title"><a href="/myblog/technology/" class="link-title">Golang</a> <span class="title" style="display:none;">Golang</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/myblog/pages/9a7ee40fc232253e/" class="nav-link">技术文档</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="随笔" class="dropdown-title"><a href="/myblog/more/" class="link-title">随笔</a> <span class="title" style="display:none;">随笔</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/myblog/pages/9a7ee40fc232253e/" class="nav-link">学习</a></li></ul></div></div><div class="nav-item"><a href="/myblog/about/" class="nav-link">关于</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="收藏" class="dropdown-title"><a href="/myblog/pages/beb6c0bd8a66cea6/" class="link-title">收藏</a> <span class="title" style="display:none;">收藏</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/myblog/pages/beb6c0bd8a66cea6/" class="nav-link">网站</a></li><li class="dropdown-item"><!----> <a href="/myblog/pages/eee83a9211a70f9d/" class="nav-link">资源</a></li><li class="dropdown-item"><!----> <a href="/myblog/pages/12df8ace52d493f6/" class="nav-link">Vue资源</a></li></ul></div></div> <a href="https://github.com/richLpf" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>实战项目</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/myblog/pages/2e72bd/" class="sidebar-link">Gin搭建项目-项目初始化</a></li><li><a href="/myblog/pages/9a7ee40fc232253e/" class="sidebar-link">Gin搭建项目-引入数据库</a></li><li><a href="/myblog/pages/cf7d59/" class="sidebar-link">Gin搭建项目-单元测试</a></li><li><a href="/myblog/pages/d32de82222/" class="sidebar-link">Gin搭建项目-打印日志</a></li><li><a href="/myblog/pages/d32de8/" class="sidebar-link">Gin搭建项目-自动化构建</a></li><li><a href="/myblog/pages/t0006/" aria-current="page" class="active sidebar-link">Gin搭建项目-企业微信开发</a></li></ul></section></li></ul> </aside> <div><main class="page"> <div class="theme-vdoing-wrapper"><div class="articleInfo-wrap" data-v-23da8cbc><div class="articleInfo" data-v-23da8cbc><ul class="breadcrumbs" data-v-23da8cbc><li data-v-23da8cbc><a href="/myblog/" title="首页" class="iconfont icon-home router-link-active" data-v-23da8cbc></a></li> <li data-v-23da8cbc><a href="/myblog/technology" title="技术-目录页" data-v-23da8cbc>技术</a></li> <li data-v-23da8cbc><a href="/myblog/technology/#实战项目" title="技术#实战项目" data-v-23da8cbc>实战项目</a></li></ul> <div class="info" data-v-23da8cbc><div title="作者" class="author iconfont icon-touxiang" data-v-23da8cbc><a href="https://pengfeilv.gitee.io/myblog/" target="_blank" title="作者" class="beLink" data-v-23da8cbc>鹏飞</a></div> <div title="创建时间" class="date iconfont icon-riqi" data-v-23da8cbc><a href="javascript:;" data-v-23da8cbc>2020-05-31</a></div> <!----></div></div></div> <!----> <div class="content-wrapper"><!----> <h1><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAYAAAA7MK6iAAAAAXNSR0IArs4c6QAABGpJREFUSA3tVVtoXFUU3fvOI53UlmCaKIFmwEhsE7QK0ipFEdHEKpXaZGrp15SINsXUWvBDpBgQRKi0+KKoFeJHfZA+ED9KKoIU2gYD9UejTW4rVIzm0VSTziPzuNu1z507dibTTjL4U/DAzLn3nL3X2o91ziX6f9wMFdh6Jvbm9nNSV0msViVO6tN1Rm7NMu2OpeJ9lWBUTDxrJbYTS0hInuwciu9eLHlFxCLCZEk3MegsJmZ5K/JD6t7FkFdEvGUo1g7qJoG3MHImqRIn8/nzY1K9UPKKiJmtnUqHVE3Gbuay6vJE/N2FEmuxFjW2nUuE0yQXRRxLiTUAzs36zhZvOXJPdX850EVnnLZkB8prodQoM5JGj7Xk2mvC7JB8tG04Ef5PiXtG0UtxupRQSfTnBoCy554x18yJHI6I+G5Eru4LHmPJZEQsrvPUbMiA8G/WgMK7w7I+ez7++o2ANfbrjvaOl1tFMs+htG3IrZH9/hDX1Pr8Tc0UvH8tcX29KzAgIGcEkINyW5BF9x891hw6VYqgJHEk0huccS7vh3C6gTiODL+26huuBtbct8eZnqLML8PkxGYpuPZBqtqwkSjgc4mB5gbgig5i+y0UDK35LMxXisn9xQtK+nd26gTIHsHe/oblK/b29fUmN/8Y+9jAQrnBp56m1LcDlDp9irKTExSKduXJVWSqdBMA08pEJnEIOB3FPPMybu/oeV8zFeYN3xx576Q6RH+VmplE4ncQV5v+5rzSoyOU7PuEAg8g803PwBJ0CExno/jcMbN8tONYeOmHiuUNryvm3fRUy4tMPVLdAGkUhNWuggGrJcXPv+ouCjz0MKUHz1J2/E8IC9nqTabcxgaBYM0hPhD5Y65FsbxRQKxCQrDjDctW7PUM3HuZunFyifSAqEfuzCp48Il24luWUWZoyJCaPR82jE0+kFA643wRFVni4RYSq3ohJO2pZ7B5dO4xkDWbEpossJPLSrPjYID8rS2UHTlvyNxqIGsg674XJJ7vnh5L7PNwC4hh2sjCI96mzszOTpxLF0T7l88Yz7lAuK6OnL8gXLOnTvpzSb22YG8W7us3jSebFHeeqnXRG1vt+MoUM84LQIBmMsCTAcOauTh0T0l0neQK7m2bLMt2mGxU3HYssS0J2cdv5wljlPsrIuZLAG/2DOZIXgCYT8uMGZN+e2kSirfxZOPCsC0f24nTZzspnVn9VePS1Z5vubmAGGXG8ZFno9Hel0yfA5ZPhF7Dh972BQJ2qCpgH67lmWtBYbvk6sz02wjky2vXyz0XErP/kFB619js1BtwfOV4OPRqOQBjy3Qbk18vigUPPSD5ceHnwck7W9bhAqZdd7SuG7w4/P2F/GaJh8c7e9qgow+Q7cGBo+98WsLkuktFqiZabtXuQTu/Y5ETbR0v7tNSFnvrmu6pjdoan2KjMu8q/Hmj1EfCO2ZGfEIbIXKUlw8qaX9/b2oeSJmFksSeT/Fn0V3nSypChh4Gjh74ybO9aeZ/AN2dwciu2/MhAAAAAElFTkSuQmCC">
          Gin搭建项目-自动化构建
        </h1> <div class="theme-vdoing-content content__default"><h1 id="企业微信开发整理"><a href="#企业微信开发整理" class="header-anchor">#</a> 企业微信开发整理</h1> <p>服务端API <code>https://work.weixin.qq.com/api/doc/90000/90135/90664</code></p> <p>详细代码见 <code>wechat.go</code></p> <p align="center"><img src="http://weblpf.cn-bj.ufileos.com/ufile-log%2Fweblpf%2F%E4%BC%81%E4%B8%9A%E5%BE%AE%E4%BF%A1%E5%BC%80%E5%8F%91.png" width="500"></p> <blockquote><p>企业微信开发分为服务端API和客户端API</p></blockquote> <p>一、企业微信开发前需要了解几个问题</p> <p>默认你已经知道了下面的问题</p> <p>1、企业微信开发，一般对应的是创建相关应用（这里创建应用取名：优效）</p> <p>2、<img src="https://work.weixin.qq.com/api/doc/90000/90135/90665" alt="微信的后台获取的参数"></p> <div class="language- line-numbers-mode"><pre class="language-text"><code>corpid
userid
部门id
tagid
agentid
secret
access_token
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>3、这里的开发主要是三个地方的处理</p> <ul><li>获取access_token</li> <li>身份验证-网页授权登录</li> <li>消息推送</li></ul> <p>二、获取access_token</p> <p>调用企业微信接口首先需要获取access_token，获取access_token的方法很简单</p> <p>1、首先在企业微信后台获取企业微信的企业微信ID(corpid)和应用的密钥(Secret)</p> <p>2、调用企业微信接口</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>https://qyapi.weixin.qq.com/cgi-bin/gettoken?corpid=ID&amp;corpsecret=SECRET

返回参数：
{
   &quot;errcode&quot;: 0,
   &quot;errmsg&quot;: &quot;ok&quot;,
   &quot;access_token&quot;: &quot;accesstoken000001&quot;,
   &quot;expires_in&quot;: 7200
}

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>3、缓存access_token</p> <p>定义两个全局变量，一个用来存放access_token,一个用来存放access_token失效时间</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>GLOBALTOKEN 存放access_token
GLOBALEXPIRE 存放access_token失效时间
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><ul><li>获取access_token</li> <li>查询GLOBALTOKEN是否有值，无值直接调用接口获取，若有值</li> <li>通过GLOBALEXPIRE是否失效，有效则直接返回，无效则调用接口获取</li></ul> <p>三、网页授权登录</p> <p>很多时候，我们需要在手机端查看信息，开发自己的页面展示，如果每次都登录太麻烦，可以直接调用企业微信接口获取用户信息，在再此之前需要通过认证</p> <table><thead><tr><th>参数</th> <th>必须</th> <th>说明</th></tr></thead> <tbody><tr><td>appid</td> <td>是</td> <td>企业的CorpID</td></tr> <tr><td>redirect_uri</td> <td>是</td> <td>授权后重定向的回调链接地址，请使用urlencode对链接进行处理</td></tr> <tr><td>response_type</td> <td>是</td> <td>返回类型，此时固定为：code</td></tr> <tr><td>scope</td> <td>是</td> <td>应用授权作用域。企业自建应用固定填写：snsapi_base</td></tr> <tr><td>state</td> <td>否</td> <td>重定向后会带上state参数，企业可以填写a-zA-Z0-9的参数值，长度不可超过128个字节</td></tr> <tr><td>#wechat_redirect</td> <td>是</td> <td>终端使用此参数判断是否需要带上身份信息</td></tr></tbody></table> <div class="language- line-numbers-mode"><pre class="language-text"><code>假定当前
企业CorpID：wxCorpId
访问链接：http://api.3dept.com/cgi-bin/query?action=get
根据URL规范，将上述参数分别进行UrlEncode，得到拼接的OAuth2链接为：
https://open.weixin.qq.com/connect/oauth2/authorize?appid=wxCorpId&amp;redirect_uri=http%3a%2f%2fapi.3dept.com%2fcgi-bin%2fquery%3faction%3dget&amp;response_type=code&amp;scope=snsapi_base&amp;state=#wechat_redirect
员工点击后，页面将跳转至 
http://api.3dept.com/cgi-bin/query?action=get&amp;code=AAAAAAgG333qs9EdaPbCAP1VaOrjuNkiAZHTWgaWsZQ&amp;state=
企业可根据code参数调用获得员工的userid

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><blockquote><p>注意到，构造OAuth2链接中参数的redirect_uri是经过UrlEncode的</p></blockquote> <p>通过构造OAuth2链接，可以进行微信认证，拿到code就可以获取用户信息</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>// access_token 第二步获取的access_token
// code 第三步获取的code,code有效期为5分钟，只能使用一次
https://qyapi.weixin.qq.com/cgi-bin/user/getuserinfo?access_token=ACCESS_TOKEN&amp;code=CODE

{
   &quot;errcode&quot;: 0,
   &quot;errmsg&quot;: &quot;ok&quot;,
   &quot;UserId&quot;:&quot;USERID&quot;,
   &quot;DeviceId&quot;:&quot;DEVICEID&quot;
}

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>获取userid后，在调用读取成员信息接口</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>https://qyapi.weixin.qq.com/cgi-bin/user/get?access_token=ACCESS_TOKEN&amp;userid=USERID

// 返回的信息（展示部分）
{
    &quot;errcode&quot;: 0,
    &quot;errmsg&quot;: &quot;ok&quot;,
    &quot;userid&quot;: &quot;zhangsan&quot;,
    &quot;name&quot;: &quot;李四&quot;,
    &quot;department&quot;: [1, 2],
    &quot;order&quot;: [1, 2],
}

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p>注意：上面如果每次打开企业微信，重定向获取code会有时间的消耗，而且转发、刷新后会导致页面获取用户信息失败，最好进行下面的处理</p> <p>1、前端拿到code后，返回给后端，后端返回用户信息、cookies信息和有效期（服务端设置），前端缓存在本地，作为用户登录的凭证
2、前端直接使用自己页面的链接，如果没有cookies信息，在前端重定向到认证页面，获取code,调用接口，缓存信息
3、获取用户信息，登录页面</p> <p>这样处理就比较灵活，可以跟据页面设置有效期，页面的打开速度也会快了很多。</p> <p>四、推送信息</p> <p>企业微信支持的消息类型有</p> <ul><li>文本消息</li> <li>图片消息</li> <li>语音消息</li> <li>视频消息</li> <li>文件消息</li> <li>文本卡片消息</li> <li>图文消息</li> <li>图文消息（mpnews）</li> <li>markdown消息</li> <li>小程序通知消息</li> <li>任务卡片消息</li></ul> <p>1、推送信息给个人</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>https://qyapi.weixin.qq.com/cgi-bin/message/send?access_token=ACCESS_TOKEN

对应的请求参数，不通类型不通可以通过企业微信查看(https://work.weixin.qq.com/api/doc/90000/90135/90236)

// 返回参数
 {
   &quot;errcode&quot; : 0,
   &quot;errmsg&quot; : &quot;ok&quot;,
   &quot;invaliduser&quot; : &quot;userid1|userid2&quot;,
   &quot;invalidparty&quot; : &quot;partyid1|partyid2&quot;,
   &quot;invalidtag&quot;: &quot;tagid1|tagid2&quot;
 }

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p>如果所有的用户不存在，才会返回失败，部分不存在会提示在invaliduser字段中</p> <p>2、推送信息给群聊</p> <p>企业微信必须通过api创建群聊，然后才能进行推送</p> <p>创建群聊：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>https://qyapi.weixin.qq.com/cgi-bin/appchat/create?access_token=ACCESS_TOKEN

//请求参数
{
    &quot;name&quot; : &quot;NAME&quot;,
    &quot;owner&quot; : &quot;userid1&quot;,
    &quot;userlist&quot; : [&quot;userid1&quot;, &quot;userid2&quot;, &quot;userid3&quot;],
    &quot;chatid&quot; : &quot;CHATID&quot;
}

//返回参数
{
    &quot;errcode&quot; : 0,
    &quot;errmsg&quot; : &quot;ok&quot;,
    &quot;chatid&quot; : &quot;CHATID&quot;
}

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><table><thead><tr><th>参数</th> <th>是否必须</th> <th>说明</th></tr></thead> <tbody><tr><td>access_token</td> <td>是</td> <td>调用接口凭证</td></tr> <tr><td>name</td> <td>否</td> <td>群聊名，最多50个utf8字符，超过将截断</td></tr> <tr><td>owner</td> <td>否</td> <td>指定群主的id。如果不指定，系统会随机从userlist中选一人作为群主</td></tr> <tr><td>userlist</td> <td>是</td> <td>群成员id列表。至少2人，至多2000人</td></tr> <tr><td>chatid</td> <td>否</td> <td>群聊的唯一标志，不能与已有的群重复；字符串类型，最长32个字符。只允许字符0-9及字母a-zA-Z。如果不填，系统会随机生成群id</td></tr></tbody></table> <p>推送群聊信息</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>https://qyapi.weixin.qq.com/cgi-bin/appchat/send?access_token=ACCESS_TOKEN

//对应的请求参数，不通类型不通可以通过企业微信查看(https://work.weixin.qq.com/api/doc/90000/90135/90248)

{
    &quot;chatid&quot;: &quot;CHATID&quot;,
    &quot;msgtype&quot;:&quot;text&quot;,
    &quot;text&quot;:{
        &quot;content&quot; : &quot;你的快递已到\n请携带工卡前往邮件中心领取&quot;
    },
    &quot;safe&quot;:0
}

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div></div></div> <div class="page-edit"><div class="edit-link"><a href="https://github.com/richLpf/edit/master/docs/03.技术/01.实战项目/06.Gin搭建项目-企业微信开发.md" target="_blank" rel="noopener noreferrer">编辑</a> <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></div> <!----> <!----></div> <div class="page-nav-wapper"><div class="page-nav-centre-wrap"><a href="/myblog/pages/d32de8/" data-tooltip="Gin搭建项目-自动化构建" class="page-nav-centre page-nav-centre-prev"></a> <!----> <div class="tooltip" style="display:none;">提高学习效率的策略</div></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/myblog/pages/d32de8/" class="prev">Gin搭建项目-自动化构建</a></span> <!----></p></div></div></div> <div class="article-list"><div class="article-title"><a href="/myblog/archives/" class="iconfont icon-shizhong">最近更新</a></div> <div class="article-wrapper"><dl><dd>01</dd> <dt><a href="/myblog/pages/d32de8/"><div>Gin搭建项目-自动化构建</div></a> <span>05-31</span></dt></dl><dl><dd>02</dd> <dt><a href="/myblog/pages/d32de82222/"><div>Gin搭建项目-打印日志</div></a> <span>05-17</span></dt></dl><dl><dd>03</dd> <dt><a href="/myblog/pages/cf7d59/"><div>Gin搭建项目-单元测试</div></a> <span>05-16</span></dt></dl> <dl><dd></dd> <dt><a href="/myblog/archives/" class="more">更多文章&gt;</a></dt></dl></div></div> </main></div> <div class="footer"><div class="icons"><a href="mailto:1045465391@qq.com" title="发邮件" target="_blank" class="iconfont icon-youjian"></a><a href="https://github.com/richLpf" title="GitHub" target="_blank" class="iconfont icon-github"></a><a href="https://music.163.com/#/playlist?id=755597173" title="听音乐" target="_blank" class="iconfont icon-erji"></a></div> 
  Theme by <a href="https://github.com/xugaoyi/vuepress-theme-vdoing" target="_blank" title="本站主题">Vdoing</a> 
     | Copyright © 2020-2020
    <span>Pengfei | MIT License</span></div> <div class="buttons"><div title="返回顶部" class="button blur go-to-top iconfont icon-fanhuidingbu" style="display:none;"></div> <div title="去评论" class="button blur go-to-comment iconfont icon-pinglun" style="display:none;"></div> <div title="主题模式" class="button blur theme-mode-but iconfont icon-zhuti"><ul class="select-box" style="display:none;"><li class="iconfont icon-zidong">
          跟随系统
        </li><li class="iconfont icon-rijianmoshi">
          浅色模式
        </li><li class="iconfont icon-yejianmoshi">
          深色模式
        </li><li class="iconfont icon-yuedu">
          阅读模式
        </li></ul></div></div> <!----></div><div class="global-ui"><div></div></div></div>
    <script src="/myblog/assets/js/app.56c8d9b2.js" defer></script><script src="/myblog/assets/js/2.d64386e3.js" defer></script><script src="/myblog/assets/js/21.138908cd.js" defer></script>
  </body>
</html>